; ============================================================
; PHP 高性能优化配置
; 适用于: 宝塔面板 PHP 7.4
; 路径: /www/server/php/74/etc/php.ini
;
; 使用方法: 在 php.ini 中找到对应参数并修改为以下值
;           或直接追加到文件末尾 (后面的值会覆盖前面的)
; ============================================================

; ============================================================
; 核心参数
; ============================================================

; 单个脚本最大内存 - 生成订阅时节点多会消耗大量内存
memory_limit = 512M

; 最大执行时间 (秒) - CLI 模式下为 0 (无限)
max_execution_time = 300

; 最大输入时间 (秒)
max_input_time = 300

; POST 最大大小
post_max_size = 128M

; 上传文件最大大小
upload_max_filesize = 128M

; ============================================================
; OPcache - 最关键的性能优化
; ============================================================

; 启用 OPcache (必须!)
opcache.enable = 1

; CLI 模式也启用
opcache.enable_cli = 0

; OPcache 共享内存大小 (MB) - 缓存编译后的 PHP 代码
opcache.memory_consumption = 256

; 暂存池大小 (MB)
opcache.interned_strings_buffer = 32

; 最大缓存文件数 - SSPanel 文件多，设大一些
opcache.max_accelerated_files = 30000

; 检查文件更新的频率 (秒)
; 生产环境设 60 或更高，减少文件 stat 调用
; 开发环境设 0
opcache.revalidate_freq = 60

; 不检查文件时间戳 - 生产环境性能最高
; 注意: 修改 PHP 文件后需要手动重启 PHP-FPM 才能生效
; 如果经常改代码就设为 0
opcache.validate_timestamps = 0

; 快速关闭 - 加速 PHP worker 回收
opcache.fast_shutdown = 1

; 保存注释 - 某些框架需要
opcache.save_comments = 1

; ============================================================
; Realpath 缓存 - 减少文件系统调用
; ============================================================

realpath_cache_size = 4096k
realpath_cache_ttl = 600

; ============================================================
; Session - 如果用文件存储 session
; ============================================================

session.save_handler = files
session.gc_maxlifetime = 1440

; ============================================================
; 错误日志
; ============================================================

; 生产环境关闭显示错误
display_errors = Off
display_startup_errors = Off

; 记录错误到日志
log_errors = On
error_log = /www/server/php/74/var/log/php_error.log

; 错误级别
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT & ~E_NOTICE

; ============================================================
; 其他性能参数
; ============================================================

; 禁用不需要的危险函数 (根据需要调整)
; disable_functions = 保持宝塔默认即可

; 输出缓冲
output_buffering = 4096

; 默认 socket 超时
default_socket_timeout = 30

; MySQL 持久连接 (减少连接建立开销)
mysqli.allow_persistent = On
mysqli.max_persistent = -1
pdo_mysql.default_socket = /tmp/mysql.sock
